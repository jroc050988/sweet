(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d216802"],{c373:function(e,t,o){"use strict";o.r(t);var l=o("7a23");const a={class:"container"},c={class:"adminInner"},r={class:"btnBox"},s={class:"pdtList"},d={class:"mt-4"},i=Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",null,[Object(l["createElementVNode"])("th",{width:"120"},"訂單日期"),Object(l["createElementVNode"])("th",{width:"360"},"訂單編號"),Object(l["createElementVNode"])("th",{width:"120"},"訂購人"),Object(l["createElementVNode"])("th",{width:"120"},"付款日期"),Object(l["createElementVNode"])("th",null,"備註"),Object(l["createElementVNode"])("th")])],-1),n={key:0},m={key:1},b={class:"btn-group"},u=["onClick"],O=["onClick"];function p(e,t,o,p,j,h){const V=Object(l["resolveComponent"])("Header"),N=Object(l["resolveComponent"])("OrderModal"),f=Object(l["resolveComponent"])("Loading"),E=Object(l["resolveComponent"])("DelModal");return Object(l["openBlock"])(),Object(l["createElementBlock"])(l["Fragment"],null,[Object(l["createVNode"])(V),Object(l["createElementVNode"])("div",a,[Object(l["createElementVNode"])("div",c,[Object(l["createElementVNode"])("div",r,[Object(l["createElementVNode"])("button",{type:"button",class:"btn btn-primary mr-2 border-start-0",onClick:t[0]||(t[0]=e=>h.openDelModal(!0))}," 刪除所有訂單 ")]),Object(l["createElementVNode"])("div",s,[Object(l["createElementVNode"])("table",d,[i,Object(l["createElementVNode"])("tbody",null,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(j.orderList,(t,o)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{key:o},[Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.$filter.getDate(1e3*t.create_at)),1),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(t.id),1),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(t.user.name),1),t.is_paid?(Object(l["openBlock"])(),Object(l["createElementBlock"])("td",n,Object(l["toDisplayString"])(t.paid_date),1)):(Object(l["openBlock"])(),Object(l["createElementBlock"])("td",m," 尚未付款 ")),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(t.message),1),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("div",b,[Object(l["createElementVNode"])("button",{class:"btn btn-outline-primary btn-sm","data-bs-toggle":"modal","data-bs-target":"#Modal",onClick:Object(l["withModifiers"])(e=>h.openDetail(t),["prevent"])}," 編輯 ",8,u),Object(l["createElementVNode"])("button",{class:"btn btn-outline-danger btn-sm","data-bs-toggle":"modal","data-bs-target":"#delModal",onClick:e=>h.openDelModal(!1,t)}," 刪除 ",8,O)])])]))),128))])])]),Object(l["createVNode"])(N,{ref:"detail",data:j.orderDetail,onUpdata:h.updataOrder},null,8,["data","onUpdata"]),Object(l["createVNode"])(f,{isShow:j.isLoading},null,8,["isShow"]),Object(l["createVNode"])(E,{ref:"delModal",pdt:j.orderDetail,isAll:j.isAll,onDelProduct:h.delProduct,onDelAll:h.deleteAll},null,8,["pdt","isAll","onDelProduct","onDelAll"])])])],64)}var j=o("1985");const h={class:"modal fade orderModal",tabindex:"-1",ref:"modal"},V={class:"modal-dialog modal-xl",role:"document"},N={class:"modal-header"},f={class:"modalTitle"},E=Object(l["createElementVNode"])("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),g={key:0,class:"modal-body"},y={class:"row"},k={class:"col-sm-4"},v={class:"mb-3"},D={for:"name",class:"form-label inputTitle"},M=Object(l["createTextVNode"])(" 訂購人姓名 "),w={class:"mb-3"},C={for:"email",class:"form-label inputTitle"},B=Object(l["createTextVNode"])(" 聯絡電子信箱 "),S={class:"mb-3"},$={for:"tel",class:"form-label inputTitle"},L=Object(l["createTextVNode"])(" 手機號碼 "),x={class:"mb-3"},T=Object(l["createElementVNode"])("label",{for:"add",class:"form-label"},[Object(l["createTextVNode"])(" 收件地址 "),Object(l["createElementVNode"])("span",{class:"tag"},"必填")],-1),_={class:"col-sm-8"},A={class:"orderDetailList mb-1"},I={class:"w-100"},U={class:"orderTitle"},q=Object(l["createElementVNode"])("td",null,"名稱",-1),P=Object(l["createElementVNode"])("td",{width:"80"},"原價",-1),F=Object(l["createElementVNode"])("td",{width:"80"},"售價",-1),z=Object(l["createElementVNode"])("td",{width:"60"},"數量",-1),J=Object(l["createElementVNode"])("td",{width:"80"},"小計",-1),H={key:0,width:"80"},G=Object(l["createElementVNode"])("td",{width:"80"},"刪除",-1),K=["onUpdate:modelValue","onChange"],Q={key:0},R=["onClick"],W={key:0},X={colspan:"7",class:"text-left"},Y={class:"orderTotal"},Z={class:"orderItem"},ee=Object(l["createElementVNode"])("p",{class:"title"},"總價",-1),te={key:0,class:"orderItem red"},oe=Object(l["createElementVNode"])("p",{class:"title"},"折扣",-1),le={class:"orderItem"},ae=Object(l["createElementVNode"])("p",{class:"title"},"運費",-1),ce={class:"orderItem"},re=Object(l["createElementVNode"])("p",{class:"title"},"結算",-1),se=Object(l["createElementVNode"])("div",{class:"modal-footer"},[Object(l["createElementVNode"])("button",{type:"button",class:"btn btn-outline-primary","data-bs-dismiss":"modal"}," 取消 "),Object(l["createElementVNode"])("button",{class:"btn btn-primary"}," 確定 ")],-1);function de(e,t,o,a,c,r){const s=Object(l["resolveComponent"])("font-awesome-icon"),d=Object(l["resolveComponent"])("Field"),i=Object(l["resolveComponent"])("ErrorMessage"),n=Object(l["resolveComponent"])("Form");return Object(l["openBlock"])(),Object(l["createElementBlock"])("div",h,[Object(l["createElementVNode"])("div",V,[Object(l["createVNode"])(n,{class:"modal-content border-0",onSubmit:r.onSubmit},{default:Object(l["withCtx"])(({errors:a})=>[Object(l["createElementVNode"])("div",N,[Object(l["createElementVNode"])("p",f,[Object(l["createElementVNode"])("span",null,"訂單編號: "+Object(l["toDisplayString"])(o.data.id),1)]),E]),o.data.user?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",g,[Object(l["createElementVNode"])("div",y,[Object(l["createElementVNode"])("div",k,[Object(l["createElementVNode"])("div",v,[Object(l["createElementVNode"])("label",D,[Object(l["createVNode"])(s,{icon:"fa-solid fa-stroopwafel"}),M]),Object(l["createVNode"])(d,{type:"text",class:Object(l["normalizeClass"])(["form-control",{"is-invalid":a["訂購人姓名"]}]),id:"name",modelValue:c.order.user.name,"onUpdate:modelValue":t[0]||(t[0]=e=>c.order.user.name=e),rules:"required",name:"訂購人姓名"},null,8,["modelValue","class"]),Object(l["createVNode"])(i,{name:"訂購人姓名",class:"inputNote"})]),Object(l["createElementVNode"])("div",w,[Object(l["createElementVNode"])("label",C,[Object(l["createVNode"])(s,{icon:"fa-solid fa-stroopwafel"}),B]),Object(l["createVNode"])(d,{type:"email",class:Object(l["normalizeClass"])(["form-control",{"is-invalid":a["聯絡電子信箱"]}]),id:"email",modelValue:c.order.user.email,"onUpdate:modelValue":t[1]||(t[1]=e=>c.order.user.email=e),rules:"required|email",name:"聯絡電子信箱"},null,8,["modelValue","class"]),Object(l["createVNode"])(i,{name:"聯絡電子信箱",class:"inputNote"})]),Object(l["createElementVNode"])("div",S,[Object(l["createElementVNode"])("label",$,[Object(l["createVNode"])(s,{icon:"fa-solid fa-stroopwafel"}),L]),Object(l["createVNode"])(d,{type:"text",class:Object(l["normalizeClass"])(["form-control",{"is-invalid":a["手機號碼"]}]),id:"tel",modelValue:c.order.user.tel,"onUpdate:modelValue":t[2]||(t[2]=e=>c.order.user.tel=e),name:"手機號碼",rules:r.isPhone},null,8,["modelValue","class","rules"]),Object(l["createVNode"])(i,{name:"手機號碼",class:"inputNote"})]),Object(l["createElementVNode"])("div",x,[T,Object(l["createVNode"])(d,{type:"text",class:Object(l["normalizeClass"])(["form-control",{"is-invalid":a["收件地址"]}]),id:"add",name:"收件地址",modelValue:c.order.user.address,"onUpdate:modelValue":t[3]||(t[3]=e=>c.order.user.address=e),rules:"required"},null,8,["class","modelValue"]),Object(l["createVNode"])(i,{name:"收件地址",class:"inputNote"})])]),Object(l["createElementVNode"])("div",_,[Object(l["createElementVNode"])("div",A,[Object(l["createElementVNode"])("table",I,[Object(l["createElementVNode"])("thead",null,[Object(l["createElementVNode"])("tr",U,[q,P,F,z,J,c.coupon?(Object(l["openBlock"])(),Object(l["createElementBlock"])("td",H,"折扣後")):Object(l["createCommentVNode"])("",!0),G])]),Object(l["createElementVNode"])("tbody",null,[(Object(l["openBlock"])(!0),Object(l["createElementBlock"])(l["Fragment"],null,Object(l["renderList"])(c.products,(t,o)=>(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",{key:o},[Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(t.product.title),1),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.$filter.currency(t.product.origin_price)),1),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.$filter.currency(t.product.price)),1),Object(l["createElementVNode"])("td",null,[Object(l["withDirectives"])(Object(l["createElementVNode"])("input",{type:"number","onUpdate:modelValue":e=>t.qty=e,onChange:e=>r.updataItem(t)},null,40,K),[[l["vModelText"],t.qty]])]),Object(l["createElementVNode"])("td",null,Object(l["toDisplayString"])(e.$filter.currency(t.total)),1),c.coupon?(Object(l["openBlock"])(),Object(l["createElementBlock"])("td",Q,Object(l["toDisplayString"])(e.$filter.currency(t.final_total)),1)):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("td",null,[Object(l["createElementVNode"])("a",{href:"#",title:"刪除",class:"d-block",onClick:Object(l["withModifiers"])(e=>r.deleteItem(t),["prevent"])},[Object(l["createVNode"])(s,{icon:"fa-solid fa-trash-can"})],8,R)])]))),128)),c.coupon?(Object(l["openBlock"])(),Object(l["createElementBlock"])("tr",W,[Object(l["createElementVNode"])("td",X,[Object(l["createVNode"])(s,{icon:"fa-solid fa-circle-check"}),Object(l["createTextVNode"])(" 已套用"+Object(l["toDisplayString"])(c.coupon.title)+'優惠券"'+Object(l["toDisplayString"])(c.coupon.code)+'"；折扣'+Object(l["toDisplayString"])(100-c.coupon.percent)+"% ",1)])])):Object(l["createCommentVNode"])("",!0)])])]),Object(l["createElementVNode"])("div",Y,[Object(l["createElementVNode"])("div",Z,[ee,Object(l["createElementVNode"])("p",null,"$ "+Object(l["toDisplayString"])(e.$filter.currency(c.origin_total)),1)]),c.coupon?(Object(l["openBlock"])(),Object(l["createElementBlock"])("div",te,[oe,Object(l["createElementVNode"])("p",null,"– $ "+Object(l["toDisplayString"])(e.$filter.currency(c.discount)),1)])):Object(l["createCommentVNode"])("",!0),Object(l["createElementVNode"])("div",le,[ae,Object(l["createElementVNode"])("p",null,"$ "+Object(l["toDisplayString"])(c.fare),1)]),Object(l["createElementVNode"])("div",ce,[re,Object(l["createElementVNode"])("p",null,"$ "+Object(l["toDisplayString"])(e.$filter.currency(c.finalTotal)),1)])])])])])):Object(l["createCommentVNode"])("",!0),se]),_:1},8,["onSubmit"])])],512)}var ie=o("8ad7"),ne={data(){return{order:{},coupon:{},products:[],origin_total:0,fare:0,finalTotal:0,discount:0}},mixins:[ie["a"]],props:{data:{type:Object,defalut(){return{}}}},watch:{data(){this.origin_total=0,this.order=this.data,this.products=Object.values(this.data.products),Object.values(this.order.products).forEach(e=>{this.coupon=e.coupon}),this.count()}},methods:{updataItem(e){this.products.forEach((t,o)=>{t.id===e.id&&(this.products[o].total=e.qty*e.product.price,this.coupon&&(this.products[o].final_total=this.products[o].total*(e.coupon.percent/100)))}),this.count()},deleteItem(e){this.products.forEach((t,o)=>{t.id===e.id&&(this.products.splice(o,1),this.order.products=this.products)}),this.count()},count(){this.origin_total=0,this.finalTotal=0,this.products.forEach(e=>{this.origin_total+=e.total}),this.fare=this.origin_total>3e3?0:150,this.coupon?(this.products.forEach(e=>{this.finalTotal+=e.final_total}),this.finalTotal+=this.fare,this.discount=this.origin_total+this.fare-this.finalTotal):this.finalTotal=this.origin_total+this.fare},onSubmit(){this.$emit("updata",this.order)},isPhone(e){const t=/^(09)[0-9]{8}$/;return!!t.test(e)||"請輸入正確的手機號碼"}}},me=o("6b0d"),be=o.n(me);const ue=be()(ne,[["render",de]]);var Oe=ue,pe=o("3a5e"),je=o("cb98"),he={data(){return{orderList:[],isLoading:!1,orderDetail:{},isAll:!1}},components:{Header:j["a"],OrderModal:Oe,Loading:pe["a"],DelModal:je["a"]},inject:["emitter"],methods:{openDetail(e){this.orderDetail=JSON.parse(JSON.stringify(e)),this.$refs.detail.showModal()},openDelModal(e,t){this.isAll=e,e||(this.orderDetail=t),this.$refs.delModal.showModal()},delProduct(e){if("allOrder"===e)this.deleteAll();else{this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/lili-testapi/admin/order/"+e.id;this.$http.delete(t).then(e=>{e.data.success?(this.$refs.delModal.hideModal(),this.getOrder(),this.isLoading=!1,this.emitter.emit("pushMessage",{style:"success",content:e.data.message,icon:"fa-solid fa-circle-check"})):(this.emitter.emit("pushMessage",{style:"fail",content:e.data.message,icon:"fa-solid fa-triangle-exclamation"}),this.$refs.delModal.hideModal(),this.isLoading=!1)}).catch(e=>{console.error(e)})}},getOrder(){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/lili-testapi/admin/orders";this.$http.get(e).then(e=>{e.data.success?(this.orderList=e.data.orders,this.isLoading=!1):(console.error("列表取得失敗"),this.isLoading=!1)}).catch(e=>{console.error(e)})},updataOrder(e){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/lili-testapi/admin/order/"+e.id;this.$http.put(t,{data:e}).then(e=>{e.data.success?(this.emitter.emit("pushMessage",{style:"success",content:e.data.message,icon:"fa-solid fa-circle-check"}),this.$refs.detail.hideModal(),this.getOrder(),this.isLoading=!1):(this.emitter.emit("pushMessage",{style:"fail",content:e.data.message,icon:"fa-solid fa-triangle-exclamation"}),this.isLoading=!1)}).catch(e=>{console.error(e)})},deleteAll(){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/lili-testapi/admin/orders/all";this.$http.delete(e).then(e=>{e.data.success?(this.$refs.delModal.hideModal(),this.getOrder(),this.isLoading=!1,this.emitter.emit("pushMessage",{style:"success",content:e.data.message,icon:"fa-solid fa-circle-check"})):(this.emitter.emit("pushMessage",{style:"fail",content:e.data.message,icon:"fa-solid fa-triangle-exclamation"}),this.$refs.delModal.hideModal(),this.isLoading=!1)}).catch(e=>{console.error(e)})}},mounted(){this.getOrder()}};const Ve=be()(he,[["render",p]]);t["default"]=Ve}}]);
//# sourceMappingURL=chunk-2d216802.52fb1d45.js.map